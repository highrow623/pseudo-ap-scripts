# pseudo-ap-scripts

This repository contains some scripts meant to help with the apworld logic rework found [here](https://github.com/highrow623/pseudoregalia-archipelago/tree/logic-rework/AP_Randomizer/apworldrework).

## Scripts

### `go/scripts/sheet_to_json`

This script converts the rows in [this spreadsheet](https://docs.google.com/spreadsheets/d/1uvcWRfTalfc3WheXb1Jk6K512NToWJVU5BIOehQmOQ4/edit?usp=sharing) to a JSON object that the logic rework can use.

#### Usage

Download `Pseudoregalia Tricks - Tricks.csv` and `Pseudoregalia Tricks - Tags.csv` and put them in the `sheets` folder. Run `go run go/scripts/sheet_to_json/main.go`. The script will create `tricks/tricks.json` and `tricks/tricks.min.json`, which is a minified version of the tricks file.

### `go/scripts/validate_json`

After running the previous script, you can run this one to validate certain things about the JSON file. In particular, it will check the following:
* each tag for each trick is contained within the tag hierarchy defined in `Pseudoregalia Tricks - Tags.csv`
* no two tricks for the same rule are exactly equal (same tags, same loadout requirements)
* no trick is "made unnecessary" by another trick in the rule (a trick is unnecessary if its removal wouldn't change the logic at all)

#### Usage

The script will use `tricks/tricks.json`, which is generated by the `go/scripts/sheet_to_json` script. Run `go run go/scripts/validate_json/main.go`. The script will output any errors to `results/validate_json.txt`. _Note: it will not output anything to console unless there were errors while running the script._

### `compare.py`

This script compares the logic in the rework against the logic in the main branch. It creates rules objects from each and tests every possible loadout against every rule at every difficulty, then notes any discrepancies.

#### Usage

This script uses the types defined in Archipelago, as well as in the apworld and the apworld rework. Those must all be in your `PYTHONPATH` so the script can use those types. Clone [Archipelago](https://github.com/ArchipelagoMW/Archipelago), [pseudoregalia-archipelago](https://github.com/qwint/pseudoregalia-archipelago), and the [pseudoregalia-archipalago](https://github.com/highrow623/pseudoregalia-archipelago/tree/logic-rework) fork. Put the main Archipelago folder, as well as the `AP_Randomizer` folders within each pseudoregalia apworld repo, in `PYTHONPATH`. Make sure the apworld fork is on the `logic-rework` branch.

_Note: currently, the logic in the apworld rework matches the logic in the `logic_updates` branch in the fork. In order for the script to run properly (until [the PR](https://github.com/qwint/pseudoregalia-archipelago/pull/1) gets merged), you'll need to copy the changed files into the main apworld repo._

Run `python compare.py`. The script will output any logic discrepancies to `results/compare.txt`. It will note for each rule, for each difficulty, for each loadout, whether it passes on the sheet (rework) or on the apworld.

_Note: the rework uses the `tricks.json` file found within that repo as it's source of tricks. If you want to compare changes to the sheet with this script, convert the sheet to json and drop it in the rework repo._
